name: Update Weekly Content Page

on:
  # Scheduled weekly update every Sunday at midnight UTC
  schedule:
    - cron: '0 0 * * 0'

  # Allows manual triggering of the action for testing
  workflow_dispatch:

jobs:
  update-weekly-content:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Generate new page with randomized URL
        run: |
          # Generate a random 8-character string for the URL suffix
          RANDOM_SUFFIX=$(openssl rand -hex 4)
          PAGE_NAME="lastweekstrivia${RANDOM_SUFFIX}.html"
          
          # Create the HTML content with the consistent Google Sheet link
          echo "<!DOCTYPE html><html><head><title>Weekly Trivia</title></head><body><iframe src='YOUR_GOOGLE_SHEET_URL' width='100%' height='600'></iframe></body></html>" > $PAGE_NAME

          echo "New page generated: $PAGE_NAME"

      - name: Commit and push
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add .
          git commit -m "Add weekly content page $PAGE_NAME"
          git push

      - name: Display new page URL
        run: echo "New page URL: https://eviltrivia.com/$PAGE_NAME"
