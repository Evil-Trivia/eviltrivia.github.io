<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evil Trivia - Ultra Fast Search</title>
    <script src="/js/components/autoload-banner.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #FFCC00;
            margin-top: 60px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .content-box {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .search-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .search-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .search-input {
            font-size: 18px;
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            flex: 1;
            transition: border-color 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #000;
        }
        
        .search-button {
            font-size: 16px;
            padding: 15px 30px;
            background-color: #000;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .search-button:hover {
            background-color: #333;
        }
        
        .search-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .loading-container {
            text-align: center;
            padding: 40px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .loading-text {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #000;
            transition: width 0.3s;
            width: 0%;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .results-table th {
            background-color: #f2f2f2;
            padding: 12px 8px;
            text-align: left;
            border-bottom: 2px solid #ddd;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .results-table td {
            padding: 8px;
            border-bottom: 1px solid #ddd;
            vertical-align: top;
        }
        
        .results-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .score-cell {
            font-weight: bold;
            text-align: center;
            width: 60px;
        }
        
        .term-cell {
            font-weight: 500;
            min-width: 150px;
        }
        
        .file-cell {
            font-size: 11px;
            color: #666;
            width: 120px;
        }
        
        .stats-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #000;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }
        
        .search-options {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }
        
        .option-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .results-container {
            max-height: 70vh;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
        }
        
        .ready-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
        }
        
        .ready-indicator.loading {
            background-color: #ff9800;
            animation: pulse 2s infinite;
        }
        
        .ready-indicator.ready {
            background-color: #4caf50;
        }
        
        .ready-indicator.error {
            background-color: #f44336;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .filter-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }
        
        .clipboard-btn {
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .clipboard-btn:hover {
            background-color: #218838;
        }
        
        .performance-info {
            background-color: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .performance-info h3 {
            margin-top: 0;
            color: #2e7d32;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ultra Fast Search Engine <span id="ready-indicator" class="ready-indicator loading"></span></h1>
        
        <div class="performance-info">
            <h3>⚡ Performance Boost</h3>
            <p>This search engine loads all data into memory for instant results. Initial load may take 10-30 seconds, but searches will be near-instantaneous after that!</p>
        </div>
        
        <!-- Loading Screen -->
        <div id="loading-screen" class="content-box">
            <div class="loading-container">
                <div class="loading-text" id="loading-text">Initializing search engine...</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div id="loading-details" style="font-size: 14px; color: #888; margin-top: 10px;">
                    Preparing to load word lists...
                </div>
            </div>
        </div>
        
        <!-- Search Interface -->
        <div id="search-interface" class="hidden">
            <div class="content-box">
                <div class="search-container">
                    <div class="search-row">
                        <input type="text" id="search-input" class="search-input" 
                               placeholder="Type to search instantly... (e.g., apple, *science*, ???le, X Y X)"
                               autocomplete="off">
                        <button id="clear-btn" class="search-button" style="background-color: #dc3545;">Clear</button>
                    </div>
                    
                    <div class="search-options">
                        <div class="option-group">
                            <input type="checkbox" id="crossword-mode">
                            <label for="crossword-mode">Crossword Mode (? = letters only)</label>
                        </div>
                        <div class="option-group">
                            <input type="checkbox" id="variable-mode">
                            <label for="variable-mode">Variable Mode (X Y X pattern)</label>
                        </div>
                        <div class="option-group">
                            <input type="checkbox" id="ignore-spaces">
                            <label for="ignore-spaces">Ignore Spaces</label>
                        </div>
                    </div>
                    
                    <div class="filter-controls">
                        <label>Min Score: <select id="min-score" class="filter-select"></select></label>
                        <label>Max Score: <select id="max-score" class="filter-select"></select></label>
                        <label>File: <select id="file-filter" class="filter-select"></select></label>
                        <label>Results: <select id="result-limit" class="filter-select">
                            <option value="50">50</option>
                            <option value="100" selected>100</option>
                            <option value="250">250</option>
                            <option value="500">500</option>
                            <option value="1000">1000</option>
                        </select></label>
                    </div>
                </div>
            </div>
            
            <!-- Statistics -->
            <div class="stats-container hidden" id="stats-container">
                <div class="stat-item">
                    <div class="stat-number" id="total-results">0</div>
                    <div class="stat-label">Results</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="search-time">0ms</div>
                    <div class="stat-label">Search Time</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="avg-score">0</div>
                    <div class="stat-label">Avg Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="total-terms">0</div>
                    <div class="stat-label">Total Terms</div>
                </div>
            </div>
            
            <!-- Results -->
            <div class="content-box">
                <div id="results-container" class="results-container">
                    <div class="no-results">
                        Enter a search term above to see lightning-fast results!
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBruAY3SH0eO000LrYqwcOGXNaUuznoMkc",
            authDomain: "eviltrivia-47664.firebaseapp.com",
            databaseURL: "https://eviltrivia-47664-default-rtdb.firebaseio.com",
            projectId: "eviltrivia-47664",
            storageBucket: "eviltrivia-47664.firebasestorage.app",
            messagingSenderId: "401826818140",
            appId: "1:401826818140:web:c1df0bf4c602cc48231e99",
            measurementId: "G-2W6RK96Y34"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        
        // Fast Search Engine
        class UltraFastSearchEngine {
            constructor() {
                this.allTerms = []; // All terms loaded into memory
                this.isReady = false;
                this.files = [];
                this.totalTerms = 0;
                this.minScore = 100;
                this.maxScore = 0;
            }
            
            // Load all data into memory
            async loadAllData() {
                try {
                    this.updateProgress(0, "Getting file list...");
                    
                    // Use known file list to avoid initial data download
                    const knownFiles = ['RankedWiki_txt', 'RankedWiktionary_txt', 'ScrabbleDict_txt', 'jeopardy_wordlist_txt'];
                    
                    // Try to detect available files by checking if they exist
                    const availableFiles = [];
                    for (const fileName of knownFiles) {
                        try {
                            const testSnapshot = await db.ref(`tools/${fileName}`).limitToFirst(1).once('value');
                            if (testSnapshot.exists()) {
                                availableFiles.push(fileName);
                            }
                        } catch (error) {
                            console.warn(`File ${fileName} not accessible:`, error);
                        }
                    }
                    
                    this.files = availableFiles;
                    this.updateProgress(10, `Found ${availableFiles.length} files to load...`);
                    
                    if (availableFiles.length === 0) {
                        throw new Error('No accessible files found. Please check your permissions.');
                    }
                    
                    // Load files sequentially to avoid overwhelming Firebase
                    for (let i = 0; i < availableFiles.length; i++) {
                        const fileName = availableFiles[i];
                        await this.loadFileData(fileName, i, availableFiles.length);
                    }
                    
                    this.finishLoading();
                    
                } catch (error) {
                    console.error('Error loading data:', error);
                    let errorMessage = error.message || 'Unknown error';
                    
                    // Provide helpful error messages
                    if (error.code === 'PERMISSION_DENIED') {
                        errorMessage = 'Permission denied. Please check if you have admin access.';
                    } else if (errorMessage.includes('shallow')) {
                        errorMessage = 'Firebase version issue. Using fallback method...';
                        // Try alternative loading method
                        try {
                            await this.loadDataFallback();
                            return;
                        } catch (fallbackError) {
                            errorMessage = `Fallback failed: ${fallbackError.message}`;
                        }
                    }
                    
                    this.updateProgress(0, `Error: ${errorMessage}`, true);
                    
                    // Show troubleshooting info
                    const loadingDetails = document.getElementById('loading-details');
                    if (loadingDetails) {
                        loadingDetails.innerHTML = `
                            <div style="text-align: left; margin-top: 15px;">
                                <strong>Troubleshooting:</strong><br>
                                • Check if you're signed in as an admin<br>
                                • Verify database permissions<br>
                                • Try refreshing the page<br>
                                • Use the original regex tool as backup: <a href="/tools/regex" style="color: #000;">Regex Tool</a>
                            </div>
                        `;
                    }
                }
            }
            
            // Fallback loading method
            async loadDataFallback() {
                this.updateProgress(5, "Using fallback loading method...");
                
                const knownFiles = ['RankedWiki_txt', 'RankedWiktionary_txt', 'ScrabbleDict_txt', 'jeopardy_wordlist_txt'];
                
                for (let i = 0; i < knownFiles.length; i++) {
                    const fileName = knownFiles[i];
                    try {
                        await this.loadFileData(fileName, i, knownFiles.length);
                        this.files.push(fileName);
                    } catch (error) {
                        console.warn(`Could not load ${fileName}:`, error);
                    }
                }
                
                if (this.allTerms.length === 0) {
                    throw new Error('No data could be loaded from any files');
                }
                
                this.files = [...new Set(this.files)]; // Remove duplicates
                this.finishLoading();
            }
            
            finishLoading() {
                this.updateProgress(95, "Optimizing search index...");
                
                // Sort by score descending for better search performance
                this.allTerms.sort((a, b) => b.score - a.score);
                
                // Calculate statistics
                this.totalTerms = this.allTerms.length;
                if (this.totalTerms > 0) {
                    this.minScore = Math.min(...this.allTerms.map(t => t.score));
                    this.maxScore = Math.max(...this.allTerms.map(t => t.score));
                }
                
                this.updateProgress(100, `Search engine ready! Loaded ${this.totalTerms.toLocaleString()} terms.`);
                
                this.isReady = true;
                this.showSearchInterface();
            }
            
            async loadFileData(fileName, index, total) {
                try {
                    // Add timeout to prevent hanging
                    const timeoutPromise = new Promise((_, reject) => {
                        setTimeout(() => reject(new Error('File load timeout')), 30000); // 30 second timeout
                    });
                    
                    const dataPromise = db.ref(`tools/${fileName}`).once('value');
                    const snapshot = await Promise.race([dataPromise, timeoutPromise]);
                    const fileData = snapshot.val() || {};
                    
                    // Process all scores in this file
                    for (const score in fileData) {
                        const scoreNum = parseInt(score, 10);
                        if (isNaN(scoreNum)) continue;
                        
                        const scoreData = fileData[score];
                        for (const termId in scoreData) {
                            const termData = scoreData[termId];
                            if (termData && termData.term) {
                                this.allTerms.push({
                                    term: termData.term.toLowerCase(), // Store lowercase for faster searching
                                    originalTerm: termData.term,
                                    parentheses: termData.parentheses || '',
                                    score: scoreNum,
                                    file: fileName,
                                    termId: termId
                                });
                            }
                        }
                    }
                    
                    // Update progress
                    const progress = 10 + (index + 1) / total * 80;
                    this.updateProgress(progress, `Loaded ${fileName} (${index + 1}/${total})`);
                    
                } catch (error) {
                    console.error(`Error loading ${fileName}:`, error);
                }
            }
            
            updateProgress(percent, message, isError = false) {
                const progressFill = document.getElementById('progress-fill');
                const loadingText = document.getElementById('loading-text');
                const loadingDetails = document.getElementById('loading-details');
                const readyIndicator = document.getElementById('ready-indicator');
                
                if (progressFill) progressFill.style.width = `${percent}%`;
                if (loadingText) loadingText.textContent = message;
                if (loadingDetails) loadingDetails.textContent = `${Math.round(percent)}% complete`;
                
                if (isError) {
                    readyIndicator.className = 'ready-indicator error';
                } else if (percent >= 100) {
                    readyIndicator.className = 'ready-indicator ready';
                } else {
                    readyIndicator.className = 'ready-indicator loading';
                }
            }
            
            showSearchInterface() {
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('search-interface').classList.remove('hidden');
                
                // Setup score filters
                this.setupFilters();
                
                // Update total terms display
                document.getElementById('total-terms').textContent = this.totalTerms.toLocaleString();
                document.getElementById('stats-container').classList.remove('hidden');
                
                // Focus search input
                document.getElementById('search-input').focus();
            }
            
            setupFilters() {
                const minScoreSelect = document.getElementById('min-score');
                const maxScoreSelect = document.getElementById('max-score');
                const fileSelect = document.getElementById('file-filter');
                
                // Clear existing options
                minScoreSelect.innerHTML = '';
                maxScoreSelect.innerHTML = '';
                fileSelect.innerHTML = '';
                
                // Score options (by 10s)
                for (let score = 0; score <= 100; score += 5) {
                    const minOption = document.createElement('option');
                    minOption.value = score;
                    minOption.textContent = score;
                    minScoreSelect.appendChild(minOption);
                    
                    const maxOption = document.createElement('option');
                    maxOption.value = score;
                    maxOption.textContent = score;
                    if (score === 100) maxOption.selected = true;
                    maxScoreSelect.appendChild(maxOption);
                }
                
                // File options
                const allOption = document.createElement('option');
                allOption.value = '';
                allOption.textContent = 'All Files';
                allOption.selected = true;
                fileSelect.appendChild(allOption);
                
                this.files.forEach(fileName => {
                    const option = document.createElement('option');
                    option.value = fileName;
                    option.textContent = fileName;
                    fileSelect.appendChild(option);
                });
            }
            
            // Ultra-fast search function
            search(query) {
                if (!this.isReady || !query.trim()) {
                    return [];
                }
                
                const startTime = performance.now();
                
                // Get filter values
                const minScore = parseInt(document.getElementById('min-score').value) || 0;
                const maxScore = parseInt(document.getElementById('max-score').value) || 100;
                const fileFilter = document.getElementById('file-filter').value;
                const resultLimit = parseInt(document.getElementById('result-limit').value) || 100;
                
                // Get search options
                const crosswordMode = document.getElementById('crossword-mode').checked;
                const variableMode = document.getElementById('variable-mode').checked;
                const ignoreSpaces = document.getElementById('ignore-spaces').checked;
                
                // Compile search pattern
                const searchPattern = this.compilePattern(query, { crosswordMode, variableMode, ignoreSpaces });
                
                // Search through all terms
                const results = [];
                for (const term of this.allTerms) {
                    // Quick filters first
                    if (term.score < minScore || term.score > maxScore) continue;
                    if (fileFilter && term.file !== fileFilter) continue;
                    
                    // Pattern matching
                    if (this.testPattern(searchPattern, term.term)) {
                        results.push(term);
                        if (results.length >= resultLimit) break;
                    }
                }
                
                const endTime = performance.now();
                const searchTime = Math.round(endTime - startTime);
                
                // Update stats
                this.updateStats(results.length, searchTime, results);
                
                return results;
            }
            
            compilePattern(pattern, options) {
                const { crosswordMode, variableMode, ignoreSpaces } = options;
                
                if (variableMode) {
                    return this.compileVariablePattern(pattern, ignoreSpaces);
                }
                
                // Simple wildcard patterns
                const lowerPattern = pattern.toLowerCase();
                
                if (lowerPattern.includes('*') || lowerPattern.includes('?')) {
                    let regexPattern = lowerPattern.replace(/[.+^${}()|[\]\\]/g, '\\$&');
                    regexPattern = regexPattern.replace(/\*/g, '.*');
                    
                    if (crosswordMode) {
                        regexPattern = regexPattern.replace(/\?/g, '[a-z]');
                    } else {
                        regexPattern = regexPattern.replace(/\?/g, '.');
                    }
                    
                    return new RegExp(`^${regexPattern}$`);
                }
                
                // Simple substring search (fastest)
                return { type: 'substring', pattern: lowerPattern };
            }
            
            compileVariablePattern(pattern, ignoreSpaces) {
                // Simplified variable pattern for performance
                const cleanPattern = ignoreSpaces ? pattern.replace(/\s+/g, '') : pattern;
                return { type: 'variable', pattern: cleanPattern.toLowerCase(), ignoreSpaces };
            }
            
            testPattern(searchPattern, termText) {
                if (searchPattern.type === 'substring') {
                    return termText.includes(searchPattern.pattern);
                }
                
                if (searchPattern.type === 'variable') {
                    return this.testVariablePattern(searchPattern, termText);
                }
                
                // Regex pattern
                return searchPattern.test(termText);
            }
            
            testVariablePattern(searchPattern, termText) {
                const { pattern, ignoreSpaces } = searchPattern;
                const cleanTerm = ignoreSpaces ? termText.replace(/\s+/g, '') : termText;
                
                if (cleanTerm.length !== pattern.length) {
                    return false;
                }
                
                const assignments = new Map();
                
                for (let i = 0; i < pattern.length; i++) {
                    const patternChar = pattern[i];
                    const termChar = cleanTerm[i];
                    
                    if (/[a-z]/.test(patternChar)) {
                        if (assignments.has(patternChar)) {
                            if (assignments.get(patternChar) !== termChar) {
                                return false;
                            }
                        } else {
                            assignments.set(patternChar, termChar);
                        }
                    } else {
                        if (patternChar !== termChar) {
                            return false;
                        }
                    }
                }
                
                return true;
            }
            
            updateStats(resultCount, searchTime, results) {
                document.getElementById('total-results').textContent = resultCount.toLocaleString();
                document.getElementById('search-time').textContent = `${searchTime}ms`;
                
                if (results.length > 0) {
                    const avgScore = Math.round(results.reduce((sum, r) => sum + r.score, 0) / results.length);
                    document.getElementById('avg-score').textContent = avgScore;
                } else {
                    document.getElementById('avg-score').textContent = '0';
                }
            }
        }
        
        // Initialize search engine
        const searchEngine = new UltraFastSearchEngine();
        let isUserLoggedIn = false;
        
        // Check authentication
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                try {
                    const snapshot = await db.ref(`users/${user.uid}`).once('value');
                    const userData = snapshot.val() || {};
                    
                    const isAdmin = 
                        (userData.roles && Array.isArray(userData.roles) && userData.roles.includes('admin')) ||
                        (userData.role === 'admin');
                    
                    if (isAdmin) {
                        isUserLoggedIn = true;
                        // Start loading data
                        searchEngine.loadAllData();
                    } else {
                        document.body.innerHTML = `
                            <div class="container">
                                <div class="content-box" style="text-align: center;">
                                    <h2>Access Required</h2>
                                    <p>You need admin privileges to access this search tool.</p>
                                    <a href="/account" style="color: #000; text-decoration: none; font-weight: bold;">Go to Account Page</a>
                                </div>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('Error checking user role:', error);
                }
            } else {
                document.body.innerHTML = `
                    <div class="container">
                        <div class="content-box" style="text-align: center;">
                            <h2>Authentication Required</h2>
                            <p>Please sign in to access this search tool.</p>
                            <a href="/account" style="color: #000; text-decoration: none; font-weight: bold;">Sign In</a>
                        </div>
                    </div>
                `;
            }
        });
        
        // Search functionality
        let searchTimeout;
        
        function performSearch() {
            if (!searchEngine.isReady) return;
            
            const query = document.getElementById('search-input').value.trim();
            const resultsContainer = document.getElementById('results-container');
            
            if (!query) {
                resultsContainer.innerHTML = '<div class="no-results">Enter a search term above to see lightning-fast results!</div>';
                return;
            }
            
            const results = searchEngine.search(query);
            displayResults(results);
        }
        
        function displayResults(results) {
            const resultsContainer = document.getElementById('results-container');
            
            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="no-results">No results found. Try a different search term or adjust filters.</div>';
                return;
            }
            
            let html = `
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Score</th>
                            <th>Term</th>
                            <th>Parenthetical</th>
                            <th>File</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            results.forEach((result, index) => {
                html += `
                    <tr>
                        <td class="score-cell">${result.score}</td>
                        <td class="term-cell">${result.originalTerm}</td>
                        <td>${result.parentheses}</td>
                        <td class="file-cell">${result.file}</td>
                        <td>
                            <button class="clipboard-btn" onclick="copyToClipboard('${result.originalTerm.replace(/'/g, "\\'")}')">Copy</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            resultsContainer.innerHTML = html;
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Visual feedback could be added here
            });
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('search-input');
            const clearBtn = document.getElementById('clear-btn');
            
            // Real-time search with debouncing
            searchInput?.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(performSearch, 150); // 150ms debounce
            });
            
            // Clear button
            clearBtn?.addEventListener('click', () => {
                searchInput.value = '';
                performSearch();
                searchInput.focus();
            });
            
            // Filter change listeners
            ['min-score', 'max-score', 'file-filter', 'result-limit'].forEach(id => {
                document.getElementById(id)?.addEventListener('change', performSearch);
            });
            
            // Search option listeners
            ['crossword-mode', 'variable-mode', 'ignore-spaces'].forEach(id => {
                document.getElementById(id)?.addEventListener('change', performSearch);
            });
        });
    </script>
</body>
</html>
