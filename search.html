<!DOCTYPE html>
<html lang="en">
<!-- [Previous head section and styles remain the same] -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trivia Question Search - Debug</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <!-- [Previous styles remain the same] -->
</head>
<body>
    <h1>Trivia Question Search</h1>
    <div id="debug" style="background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace;"></div>
    
    <!-- [Previous HTML structure remains the same] -->

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBruAY3SH0eO000LrYqwcOGXNaUuznoMkc",
            authDomain: "eviltrivia-47664.firebaseapp.com",
            databaseURL: "https://eviltrivia-47664-default-rtdb.firebaseio.com",
            projectId: "eviltrivia-47664",
            storageBucket: "eviltrivia-47664.firebasestorage.app",
            messagingSenderId: "401826818140",
            appId: "1:401826818140:web:c1df0bf4c602cc48231e99",
            measurementId: "G-2W6RK96Y34"
        };

        // Debug logging function
        function debugLog(message, data = null) {
            const debugDiv = document.getElementById('debug');
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            console.log(logMessage, data);
            debugDiv.innerHTML += `<div>${logMessage}${data ? ': ' + JSON.stringify(data) : ''}</div>`;
        }

        // Initialize Firebase with error handling
        try {
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            debugLog('Firebase initialized successfully');
        } catch (error) {
            debugLog('Firebase initialization error:', error);
        }

        // Test database connection
        async function testDatabaseConnection() {
            try {
                const ref = firebase.database().ref();
                debugLog('Testing database connection...');
                const snapshot = await ref.once('value');
                const data = snapshot.val();
                debugLog('Database connection successful. Root data structure:', 
                    Object.keys(data || {}));
                return true;
            } catch (error) {
                debugLog('Database connection error:', error);
                return false;
            }
        }

        // Search function
        async function searchQuestions() {
            debugLog('Starting search...');
            
            const searchText = document.getElementById('searchInput').value.trim();
            const searchField = document.getElementById('searchField').value;
            const roundType = document.getElementById('roundTypeFilter').value;
            
            document.getElementById('loading').style.display = 'block';
            
            if (!searchText) {
                debugLog('No search text provided');
                document.getElementById('loading').style.display = 'none';
                document.getElementById('resultsBody').innerHTML = 
                    '<tr><td colspan="6">Please enter a search term.</td></tr>';
                return;
            }

            try {
                // Test connection first
                const isConnected = await testDatabaseConnection();
                if (!isConnected) {
                    throw new Error('Unable to connect to database');
                }

                // Get root reference and check available paths
                const rootRef = firebase.database().ref();
                const rootSnapshot = await rootRef.once('value');
                const rootData = rootSnapshot.val();
                debugLog('Available paths at root:', Object.keys(rootData || {}));

                // Try to access the correct paths
                const archiveRef = firebase.database().ref('trivia-archive/archive');
                const overviewRef = firebase.database().ref('trivia-archive/overview');
                
                debugLog('Fetching archive data...');
                const archiveSnapshot = await archiveRef.once('value');
                const archiveData = archiveSnapshot.val();
                debugLog('Archive data retrieved:', archiveData ? 'Found' : 'Not found');
                
                debugLog('Fetching overview data...');
                const overviewSnapshot = await overviewRef.once('value');
                const overviewData = overviewSnapshot.val();
                debugLog('Overview data retrieved:', overviewData ? 'Found' : 'Not found');

                if (!archiveData) {
                    throw new Error('No trivia data found in archive');
                }

                const searchRegex = wildcardToRegExp(searchText);
                const results = [];

                // Process the data...
                debugLog('Processing trivia data...');
                
                // [Rest of the search logic remains the same]
                
                debugLog(`Search complete. Found ${results.length} results`);
                displayResults(results);
                
            } catch (error) {
                debugLog('Error during search:', error);
                document.getElementById('resultsBody').innerHTML = 
                    `<tr><td colspan="6">Error: ${error.message}</td></tr>`;
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // [Previous helper functions remain the same]

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            debugLog('Page loaded, testing database connection...');
            testDatabaseConnection();
        });

        // Add event listeners
        document.getElementById('searchButton').addEventListener('click', searchQuestions);
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchQuestions();
            }
        });
    </script>
</body>
</html>
