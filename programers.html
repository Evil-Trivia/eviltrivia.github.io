<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ProGamers Challenge</title>
  <!--
    The "user-scalable=no" (or maximum-scale=1) helps prevent zooming on iOS when tapping rapidly.
    You may further tailor this or remove it if you want some zooming to remain possible.
  -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      text-align: center;
      /* This helps reduce scrolling or accidental moves on mobile */
      touch-action: manipulation;
    }
    .container {
      margin: 20px;
    }
    #getReady, #counterSection, #clickArea {
      margin-top: 20px;
    }
    #countdown, #timer, #counter {
      font-size: 2em;
      font-weight: bold;
      margin-top: 10px;
    }
    #clickArea {
      display: none;
      background: #3498db;
      color: #fff;
      font-size: 1.5em;
      width: 200px;
      height: 100px;
      line-height: 100px;
      margin: 20px auto;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      touch-action: manipulation; /* Additional precaution for mobile tapping */
    }
    #clickArea:active {
      background: #2980b9;
    }
    button {
      cursor: pointer;
      font-size: 1em;
      padding: 10px 20px;
    }
    form {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ProGamers Challenge</h1>
    
    <!-- STEP 1: Ask for team name -->
    <form id="teamForm">
      <label for="teamName">Team Name:</label>
      <input type="text" id="teamName" required />
      <button type="submit">Start</button>
    </form>

    <!-- STEP 2: 5-second "Get Ready" countdown -->
    <div id="getReady" style="display: none;">
      <h2>Get Ready!</h2>
      <p id="countdown">5</p>
    </div>

    <!-- STEP 3: 30-second click counter -->
    <div id="counterSection" style="display: none;">
      <h2>Press as many times as you can!</h2>
      <div id="counter">0</div>
      <p>Seconds remaining: <span id="timer">30</span></p>
    </div>

    <!-- The clickable area -->
    <button id="clickArea">Tap / Click Here!</button>
  </div>

  <!-- Include Firebase libraries -->
  <!-- (Use the scripts from your Firebase console config snippet) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    // REPLACE these config values with your actual Firebase config from your Firebase Console
    const firebaseConfig = {
      apiKey: "AIzaSyAvo7wmx01FGHhSpstZxTJULUp9GFrA-10",
      authDomain: "progamers-eviltrivia.firebaseapp.com",
      databaseURL: "https://progamers-eviltrivia-default-rtdb.firebaseio.com",
      projectId: "progamers-eviltrivia",
      storageBucket: "progamers-eviltrivia.firebasestorage.app",
      messagingSenderId: "44589032928",
      appId: "1:44589032928:web:0ebfc5daa56e85aa1bf785",
      measurementId: "G-359RVTRDTM"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // HTML elements
    const teamForm = document.getElementById('teamForm');
    const teamNameInput = document.getElementById('teamName');
    const getReadySection = document.getElementById('getReady');
    const countdownDisplay = document.getElementById('countdown');
    const counterSection = document.getElementById('counterSection');
    const clickCounterDisplay = document.getElementById('counter');
    const timerDisplay = document.getElementById('timer');
    const clickArea = document.getElementById('clickArea');

    let countdownInterval;
    let mainTimerInterval;
    let clickCount = 0;
    let teamName = '';

    // STEP 1: Handle team name submission
    teamForm.addEventListener('submit', (e) => {
      e.preventDefault();
      teamName = teamNameInput.value.trim();
      if (teamName) {
        teamForm.style.display = 'none';
        startGetReadyCountdown();
      }
    });

    // STEP 2: "Get Ready" countdown (5 seconds)
    function startGetReadyCountdown() {
      getReadySection.style.display = 'block';
      let countdownTime = 5;
      countdownDisplay.textContent = countdownTime;

      countdownInterval = setInterval(() => {
        countdownTime--;
        countdownDisplay.textContent = countdownTime;
        if (countdownTime <= 0) {
          clearInterval(countdownInterval);
          getReadySection.style.display = 'none';
          startMainTimer();
        }
      }, 1000);
    }

    // STEP 3: 30-second click counter
    function startMainTimer() {
      counterSection.style.display = 'block';
      clickArea.style.display = 'inline-block';
      clickCount = 0;
      clickCounterDisplay.textContent = clickCount;
      
      let mainTime = 30;
      timerDisplay.textContent = mainTime;

      mainTimerInterval = setInterval(() => {
        mainTime--;
        timerDisplay.textContent = mainTime;
        if (mainTime <= 0) {
          clearInterval(mainTimerInterval);
          finishGame();
        }
      }, 1000);
    }

    // Count clicks within the 30-second window
    clickArea.addEventListener('click', () => {
      if (counterSection.style.display === 'block') {
        clickCount++;
        clickCounterDisplay.textContent = clickCount;
      }
    });

    // When the game is done, store results in Firebase
    function finishGame() {
      clickArea.style.display = 'none';
      counterSection.style.display = 'none';

      // Record result in the "progamersScores" node
      const newScoreRef = database.ref('progamersScores').push();
      newScoreRef.set({
        team: teamName,
        score: clickCount,
        timestamp: Date.now()
      });

      // Reset for next user
      teamForm.style.display = 'block';
      teamNameInput.value = '';
      teamName = '';
    }
  </script>
</body>
</html>
