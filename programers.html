<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Evil Trivia 2.18.2025 Final Challenge</title>
  <!-- Prevent zooming on mobile for rapid taps -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style>
    /* Basic styling for the entire page */
    body {
      margin: 0;
      padding: 0;
      background-color: #ffcc00; /* gold */
      color: #000;              /* black text */
      font-family: Arial, sans-serif; 
      text-align: center;
      /* Helps reduce accidental scrolls/zooms on mobile */
      touch-action: manipulation;
    }

    .container {
      margin: 20px;
    }

    h1, h2, p, label {
      color: #000; /* ensure all text is black */
      margin: 10px 0;
    }

    form {
      margin: 20px 0;
    }

    /* Timer/counter display */
    #countdown,
    #timer,
    #counter {
      font-size: 2em;
      font-weight: bold;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ProGamers Challenge</h1>
    
    <!-- STEP 1: Ask for team name -->
    <form id="teamForm">
      <label for="teamName">Enter Your Team Name:</label><br>
      <input type="text" id="teamName" required />
      <button type="submit">After you press this button, you'll get a 5 second countdown before you have 30 seconds to press on the screen as many times as you can</button>
    </form>

    <!-- STEP 2: 5-second "Get Ready" countdown -->
    <div id="getReady" style="display: none;">
      <h2>Get Ready!</h2>
      <p id="countdown">5</p>
    </div>

    <!-- STEP 3: 30-second click counter -->
    <div id="counterSection" style="display: none;">
      <h2>Tap, tap, tap!</h2>
      <div id="counter">0</div>
      <p>Seconds remaining: <span id="timer">30</span></p>
    </div>
  </div>

  <!-- Include Firebase libraries -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    // ----- FIREBASE CONFIG (replace with your own) -----
    const firebaseConfig = {
      apiKey: "AIzaSyAvo7wmx01FGHhSpstZxTJULUp9GFrA-10",
      authDomain: "progamers-eviltrivia.firebaseapp.com",
      databaseURL: "https://progamers-eviltrivia-default-rtdb.firebaseio.com",
      projectId: "progamers-eviltrivia",
      storageBucket: "progamers-eviltrivia.firebasestorage.app",
      messagingSenderId: "44589032928",
      appId: "1:44589032928:web:0ebfc5daa56e85aa1bf785",
      measurementId: "G-359RVTRDTM"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // HTML elements
    const teamForm = document.getElementById('teamForm');
    const teamNameInput = document.getElementById('teamName');
    const getReadySection = document.getElementById('getReady');
    const countdownDisplay = document.getElementById('countdown');
    const counterSection = document.getElementById('counterSection');
    const clickCounterDisplay = document.getElementById('counter');
    const timerDisplay = document.getElementById('timer');

    let countdownInterval;
    let mainTimerInterval;
    let clickCount = 0;
    let teamName = '';
    let isGameActive = false; // To track when taps should count

    // STEP 1: Handle team name submission
    teamForm.addEventListener('submit', (e) => {
      e.preventDefault();
      teamName = teamNameInput.value.trim();
      if (teamName) {
        teamForm.style.display = 'none';
        startGetReadyCountdown();
      }
    });

    // STEP 2: "Get Ready" countdown (5 seconds)
    function startGetReadyCountdown() {
      getReadySection.style.display = 'block';
      let countdownTime = 5;
      countdownDisplay.textContent = countdownTime;

      countdownInterval = setInterval(() => {
        countdownTime--;
        countdownDisplay.textContent = countdownTime;
        if (countdownTime <= 0) {
          clearInterval(countdownInterval);
          getReadySection.style.display = 'none';
          startMainTimer();
        }
      }, 1000);
    }

    // STEP 3: 30-second click counter
    function startMainTimer() {
      counterSection.style.display = 'block';
      clickCount = 0;
      isGameActive = true;     // now we can count taps
      clickCounterDisplay.textContent = clickCount;
      
      let mainTime = 30;
      timerDisplay.textContent = mainTime;

      mainTimerInterval = setInterval(() => {
        mainTime--;
        timerDisplay.textContent = mainTime;
        if (mainTime <= 0) {
          clearInterval(mainTimerInterval);
          finishGame();
        }
      }, 1000);
    }

    // Listen for taps/clicks anywhere on screen
    document.addEventListener('click', () => {
      if (isGameActive) {
        clickCount++;
        clickCounterDisplay.textContent = clickCount;
      }
    });

    // When the game is done, store results in Firebase
    function finishGame() {
      isGameActive = false; // stop counting
      counterSection.style.display = 'none';

      // Record result in the "progamersScores" node
      const newScoreRef = database.ref('progamersScores').push();
      newScoreRef.set({
        team: teamName,
        score: clickCount,
        timestamp: Date.now()
      });

      // Reset for next user
      teamForm.style.display = 'block';
      teamNameInput.value = '';
      teamName = '';
    }
  </script>
</body>
</html>
